<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>vrcmort: conflict mortality estimation with explicit VR reporting collapse • vrcmort</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="vrcmort: conflict mortality estimation with explicit VR reporting collapse"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">vrcmort</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/OJWatson/vrcmort/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>vrcmort: conflict mortality estimation with explicit VR reporting collapse</h1>
      <small class="dont-index">Source: <a href="https://github.com/OJWatson/vrcmort/blob/main/PROJECT_OVERVIEW.md"><code>PROJECT_OVERVIEW.md</code></a></small>
    </div>

<div id="vrcmort-conflict-mortality-estimation-with-explicit-vr-reporting-collapse" class="section level1">

<div class="section level2">
<h2 id="purpose-of-this-repository">Purpose of this repository<a class="anchor" aria-label="anchor" href="#purpose-of-this-repository"></a></h2>
<p>This repository contains an R package, <code>vrcmort</code>, for fitting Bayesian hierarchical models that estimate <strong>true mortality</strong> from <strong>vital registration (VR)</strong> data when the <strong>observation process changes during conflict</strong>.</p>
<p>The motivating pathology is:</p>
<ul><li>Pre-conflict VR behaves like a reasonable (if imperfect) measurement of deaths.</li>
<li>Post-conflict, VR can show:
<ul><li>a spike in trauma deaths (plausible),</li>
<li>a sharp drop in non-trauma deaths (often implausible as true mortality),</li>
<li>an age-at-death distribution that becomes unnaturally young (especially missing older non-trauma deaths),</li>
<li>and strong regional variation in reporting breakdown.</li>
</ul></li>
</ul><p>If we fit a standard hierarchical small-area model that treats observed VR counts as the truth with noise, the model may incorrectly infer that increasing conflict reduces non-trauma (indirect) mortality. This is an artefact caused by <strong>under-registration and selective reporting</strong>.</p>
<p><code>vrcmort</code> addresses this by explicitly modelling two linked layers:</p>
<ol style="list-style-type: decimal"><li>a <strong>latent mortality process</strong> (what deaths truly occurred), and<br></li>
<li>a <strong>reporting process</strong> (what fraction is observed and recorded in VR, potentially in an age- and cause-selective way).</li>
</ol><p>The package aims to be: - simple to use for non-expert users (epidemia-like interface), - extensible for advanced users (modular Stan “lego bricks” and custom Stan support), - testable and reliable (simulation and benchmarking, strong checks, and CI).</p>
<hr></div>
<div class="section level2">
<h2 id="data-setting-and-practical-workflow">Data setting and practical workflow<a class="anchor" aria-label="anchor" href="#data-setting-and-practical-workflow"></a></h2>
<div class="section level3">
<h3 id="typical-raw-data">Typical raw data<a class="anchor" aria-label="anchor" href="#typical-raw-data"></a></h3>
<ul><li>Individual death records with:
<ul><li>region (admin unit),</li>
<li>month of death,</li>
<li>age and sex,</li>
<li>ICD-10 code (sometimes missing),</li>
<li>plus metadata (place of death, facility, etc).</li>
</ul></li>
</ul></div>
<div class="section level3">
<h3 id="typical-aggregation-for-modelling">Typical aggregation for modelling<a class="anchor" aria-label="anchor" href="#typical-aggregation-for-modelling"></a></h3>
<p>We usually aggregate to counts by: - region <code>r</code>, - time <code>t</code> (monthly index), - age group <code>a</code>, - sex <code>s</code>, - cause group <code>g</code> (at minimum: trauma vs non-trauma).</p>
<p>ICD-10 codes can be mapped into cause groups (for example trauma vs non-trauma). The model is built to start with two groups and later extend.</p>
</div>
<div class="section level3">
<h3 id="population-denominators-and-displacement">Population denominators and displacement<a class="anchor" aria-label="anchor" href="#population-denominators-and-displacement"></a></h3>
<p>We assume the user can provide: - region-month population and demography, - approximate displacement/migration flows by month that update denominators.</p>
<p>The model uses an <strong>exposure</strong> term, typically: - <code>exposure = pop</code> for monthly bins, or - <code>exposure = pop * days_in_month</code> for person-days, or - <code>exposure = pop * coverage_fraction</code> if only partial time coverage is credible.</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="canonical-vr-long-format">Canonical VR long format<a class="anchor" aria-label="anchor" href="#canonical-vr-long-format"></a></h2>
<p>The package operates on a canonical “VR long” table where each row is one cell <code>(r, t, a, s, g)</code>.</p>
<p>Required columns: - <code>region</code>: region identifier (character or factor) - <code>time</code>: integer time index (1..T, usually months) - <code>age</code>: integer age group index (1..A) or a factor that can be indexed - <code>sex</code>: sex label or index (1..S) - <code>cause</code>: cause group label or index (1..G; typically 1=trauma, 2=non-trauma) - <code>y</code>: observed VR death count (non-negative integer; may be NA if missing) - <code>exposure</code>: modelling denominator (positive numeric)</p>
<p>Recommended columns: - <code>pop</code>: population estimate (optional if exposure already supplied) - covariates by region-time (repeated within region-time across age/sex/cause cells): - <code>conflict</code>: conflict intensity (standardised numeric) - <code>facility</code>: health system functioning proxy (standardised numeric) - additional domain covariates (WASH, food insecurity, outbreaks, etc) - optional data quality measures: - <code>quality_score</code>, <code>icd_garbage_share</code>, <code>age_missing_share</code>, etc</p>
<hr></div>
<div class="section level2">
<h2 id="the-statistical-model">The statistical model<a class="anchor" aria-label="anchor" href="#the-statistical-model"></a></h2>
<div class="section level3">
<h3 id="indices">Indices<a class="anchor" aria-label="anchor" href="#indices"></a></h3>
<ul><li>
<code>r = 1..R</code> regions</li>
<li>
<code>t = 1..T</code> time points (months)</li>
<li>
<code>a = 1..A</code> age groups</li>
<li>
<code>s = 1..S</code> sexes</li>
<li>
<code>g = 1..G</code> cause groups (baseline implementation focuses on G=2)</li>
</ul></div>
<div class="section level3">
<h3 id="observed-and-latent-variables">Observed and latent variables<a class="anchor" aria-label="anchor" href="#observed-and-latent-variables"></a></h3>
<p>Observed VR counts: - <code>Y_{r,t,a,s,g}</code></p>
<p>Exposure (denominator): - <code>E_{r,t,a,s}</code> (stored as <code>exposure</code> in the data; repeated across cause groups)</p>
<p>Latent (true) mortality rate: - <code>λ_{r,t,a,s,g} &gt; 0</code></p>
<p>Reporting completeness probability: - <code>ρ_{r,t,a,s,g} in (0, 1)</code></p>
<p>Expected observed count: - <code>μ_{r,t,a,s,g} = E_{r,t,a,s} * λ_{r,t,a,s,g} * ρ_{r,t,a,s,g}</code></p>
<p>Likelihood: - baseline is Negative Binomial (NB2) for robustness: - <code>Y ~ NegBin2(μ, φ_g)</code> with cause-specific dispersion <code>φ_g</code></p>
<p>This is implemented in Stan.</p>
</div>
<div class="section level3">
<h3 id="mortality-submodel-log-linear">Mortality submodel (log-linear)<a class="anchor" aria-label="anchor" href="#mortality-submodel-log-linear"></a></h3>
<p>A core log-linear structure is:</p>
<p><code>log λ_{r,t,a,s,g} = α_{0,g} + α_{age[a],g} + α_{sex[s],g} + u^{(λ)}_{r,g} + v^{(λ)}_{t,g}                     + β_{conf,g} * conflict_{r,t} + X^{mort}_{i} β^{mort}_{g} + ...</code></p>
<p>Where: - <code>u^{(λ)}_{r,g}</code> is a region random intercept by cause - <code>v^{(λ)}_{t,g}</code> is a national time random walk (RW1) by cause - <code>β_{conf,g}</code> is the (global) conflict effect on true mortality by cause - <code>X^{mort}</code> is a design matrix for user-specified mortality covariates via formula input</p>
<p>Optional partial pooling extensions supported by the package: - region-varying conflict slopes: - <code>β_{conf,r,g} ~ Normal(β_{conf,g}, σ_{βconf,g})</code> - region-specific time deviations: - <code>v^{(λ,reg)}_{r,t,g}</code> as RW1 deviations around the national trend</p>
</div>
<div class="section level3">
<h3 id="reporting-submodel-logit-linear">Reporting submodel (logit-linear)<a class="anchor" aria-label="anchor" href="#reporting-submodel-logit-linear"></a></h3>
<p>A reporting model:</p>
<p><code>logit ρ_{r,t,a,s,g} = κ_{0,g} + κ_{post,g} * post_t + u^{(ρ)}_{r,g} + v^{(ρ)}_{t,g}                        + γ_{conf,g} * conflict_{r,t} + X^{rep}_{i} γ^{rep}_{g} + age_penalty(a,t,g) + ...</code></p>
<p>Where: - <code>post_t</code> indicates post-conflict period (<code>t &gt;= t0</code>) - <code>κ_{0,g}</code> is baseline completeness (anchorable with informative priors) - <code>κ_{post,g}</code> is a post-conflict shift in reporting - <code>u^{(ρ)}_{r,g}</code> and <code>v^{(ρ)}_{t,g}</code> are region and time effects for reporting - <code>γ_{conf,g}</code> allows conflict to reduce reporting completeness (often negative for non-trauma) - <code>X^{rep}</code> is a design matrix for user-specified reporting covariates</p>
<div class="section level4">
<h4 id="age-selective-reporting-collapse-non-trauma">Age-selective reporting collapse (non-trauma)<a class="anchor" aria-label="anchor" href="#age-selective-reporting-collapse-non-trauma"></a></h4>
<p>A key mechanism for the motivating pathology is a post-conflict age penalty applied mainly to non-trauma:</p>
<p><code>age_penalty(a,t,non) = - δ_a * post_t</code></p>
<p>with <code>δ_a</code> constrained to be monotone non-decreasing in age.</p>
<p>Implementation detail: - <code>δ_1 = 0</code> for youngest group - increments <code>Δ_a &gt;= 0</code> for <code>a = 2..A</code> - <code>δ_a = scale * cumulative_sum(Δ)</code> to allow a smooth monotone penalty</p>
<p>This structure captures the empirical feature that older non-trauma deaths are disproportionately missing after conflict begins.</p>
</div>
</div>
<div class="section level3">
<h3 id="misclassification-future-extension">Misclassification (future extension)<a class="anchor" aria-label="anchor" href="#misclassification-future-extension"></a></h3>
<p>The simulator supports misclassification between trauma and non-trauma among recorded deaths, via a 2x2 matrix <code>M</code>. The base Stan model may not always include explicit misclassification. It is a planned extension: - <code>E[Y_obs,g'] = Σ_g μ_true,g * M_{g -&gt; g'}</code></p>
<hr></div>
</div>
<div class="section level2">
<h2 id="identifiability-and-why-priors-matter">Identifiability and why priors matter<a class="anchor" aria-label="anchor" href="#identifiability-and-why-priors-matter"></a></h2>
<p>With only VR counts, <code>λ</code> and <code>ρ</code> are partially confounded because <code>μ = exposure * λ * ρ</code>. Therefore we must anchor the model using:</p>
<ol style="list-style-type: decimal"><li>Pre-conflict stability</li>
</ol><ul><li>Priors that keep pre-conflict reporting completeness plausible and not wildly varying.</li>
</ul><ol start="2" style="list-style-type: decimal"><li>Age patterns</li>
</ol><ul><li>The age distribution of deaths provides strong information about whether changes are due to reporting vs real mortality.</li>
<li>Monotone age penalties prevent the model from making arbitrary, non-identifiable age-specific reporting patterns.</li>
</ul><ol start="3" style="list-style-type: decimal"><li>Covariate separation</li>
</ol><ul><li>Put epidemiological drivers (food insecurity, WASH, outbreaks) mainly in mortality.</li>
<li>Put system functioning / access proxies (facility coverage, data quality indicators) mainly in reporting.</li>
<li>Conflict may appear in both, but should be regularised to avoid “effect swapping”.</li>
</ul><hr></div>
<div class="section level2">
<h2 id="the-r-package-interface">The R package interface<a class="anchor" aria-label="anchor" href="#the-r-package-interface"></a></h2>
<p>The package provides a high-level interface inspired by <code>epidemia</code> and <code>rstanarm</code>, allowing users to specify model components separately.</p>
<div class="section level3">
<h3 id="high-level-interface-vrcm">High-level interface: <code>vrcm()</code>
<a class="anchor" aria-label="anchor" href="#high-level-interface-vrcm"></a></h3>
<p>The main user-facing function is <code><a href="reference/vrcm.html">vrcm()</a></code>, which constructs and fits the model from two key components:</p>
<ul><li><code>vrcm(mortality = ..., reporting = ..., data = ..., t0 = ...)</code></li>
</ul><p>The <code>mortality</code> and <code>reporting</code> components are specified using helper functions.</p>
<ul><li>
<strong><code>vrc_mortality(formula, conflict, time)</code></strong>: Defines the latent mortality model.</li>
<li>
<strong><code>vrc_reporting(formula, conflict, time)</code></strong>: Defines the reporting process model.</li>
</ul><p>Each component allows specification of: - <code>formula</code>: A formula for additional covariates (e.g., <code>~ food_insecurity</code>). - <code>conflict</code>: How to model the conflict effect. - <code>"fixed"</code> (default): A single effect across all regions. - <code>"region"</code>: Partial pooling with region-specific random slopes. - <code>time</code>: How to model time trends. - <code>"national"</code> (default): A single random walk across all regions. - <code>"region"</code>: Region-specific random walk deviations around the national trend.</p>
</div>
<div class="section level3">
<h3 id="key-model-specification-options">Key Model Specification Options<a class="anchor" aria-label="anchor" href="#key-model-specification-options"></a></h3>
<p>The fitting process can be controlled with several key arguments passed through <code><a href="reference/vrcm.html">vrcm()</a></code> to the lower-level <code><a href="reference/vrc_fit.html">vrc_fit()</a></code> function:</p>
<ul><li>
<strong><code>pre_conflict_reporting</code></strong>: Controls the assumption about reporting before the conflict start time <code>t0</code>.
<ul><li>
<code>"estimate"</code> (default): Estimate pre-conflict reporting completeness (<code>rho</code>) from the data.</li>
<li>
<code>"fixed1"</code>: Assume pre-conflict reporting was 100% complete (<code>rho = 1</code>). This is a strong assumption that can help with model stability if pre-conflict data is reliable. This switch selects a Stan model with <code>_rho1_pre</code> in the name.</li>
</ul></li>
<li>
<strong><code>generated_quantities</code></strong>: Controls the Stan generated quantities block for performance.
<ul><li>
<code>"full"</code> (default): Computes all posterior quantities, including <code>log_lik</code> for model comparison (e.g., <code>loo</code>).</li>
<li>
<code>"none"</code>: Skips the generated quantities block for faster sampling. This is useful when only parameter estimates are needed. This switch selects a Stan model with <code>_nogq</code> in the name.</li>
</ul></li>
<li>
<strong><code>prior_PD</code></strong>: If <code>TRUE</code>, samples from the prior distribution only, ignoring the likelihood. This is useful for prior predictive checks.</li>
</ul></div>
<div class="section level3">
<h3 id="other-core-functions">Other Core Functions<a class="anchor" aria-label="anchor" href="#other-core-functions"></a></h3>
<ul><li>
<code><a href="reference/vrc_simulate.html">vrc_simulate()</a></code>: Creates simulated VR long datasets to test model performance.</li>
<li>
<code><a href="reference/vrc_validate_data.html">vrc_validate_data()</a></code>: Checks the integrity of the input data format.</li>
<li>
<code><a href="reference/vrc_priors.html">vrc_priors()</a></code>: Specify or modify priors on model parameters.</li>
<li>
<code><a href="reference/vrc_fit.html">vrc_fit()</a></code>: The lower-level fitting function that <code><a href="reference/vrcm.html">vrcm()</a></code> calls internally. It provides more direct control over model specification.</li>
</ul></div>
<div class="section level3">
<h3 id="custom-stan-workflow">Custom Stan workflow<a class="anchor" aria-label="anchor" href="#custom-stan-workflow"></a></h3>
<p>Advanced users can extend the package by: 1. Copying the modular Stan model to a local directory. 2. Editing a specific <code>.stan</code> include file (e.g., the reporting linear predictor). 3. Fitting the custom model via <code>vrc_fit(stan_model = "path/to/model.stan")</code>. This allows for custom model development while still using the package’s data preparation and posterior extraction tools.</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="software-architecture">Software architecture<a class="anchor" aria-label="anchor" href="#software-architecture"></a></h2>
<div class="section level3">
<h3 id="stan-modular-layout">Stan modular layout<a class="anchor" aria-label="anchor" href="#stan-modular-layout"></a></h3>
<p>Stan code is split into include files, roughly mirroring epidemia: - functions - data - parameters - transformed parameters - priors and likelihood - generated quantities (including <code>log_lik</code>)</p>
<p>The base model <code>.stan</code> mostly includes these pieces.</p>
</div>
<div class="section level3">
<h3 id="outputs">Outputs<a class="anchor" aria-label="anchor" href="#outputs"></a></h3>
<p>Generated quantities should include: - <code>lambda_rep</code>, <code>rho_rep</code>, <code>mu_rep</code>, <code>y_rep</code>, <code>log_lik</code> These are used for: - posterior summaries - PPCs - LOO/WAIC (via <code>loo</code>)</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="quality-assurance-requirements">Quality assurance requirements<a class="anchor" aria-label="anchor" href="#quality-assurance-requirements"></a></h2>
<p>Because Stan errors and data-initialisation issues can be subtle, the package must catch failures early.</p>
<p>Minimum QA expectations: 1) <code>R CMD check --as-cran</code> passes cleanly. 2) Vignettes render without failure. 3) Stan syntax and include resolution are tested (not only via vignettes). 4) Data initialisation dimension mismatches are tested: - especially edge cases like K_mort=1, K_rep=1. 5) At least one lightweight end-to-end sampling test exists: - tiny simulated data - small iterations - skipped on CRAN but run in CI.</p>
<p>Recommended CI: - GitHub Actions workflow that runs: - <code>devtools::check(build_vignettes = TRUE)</code> - minimal Stan parse/compile test - unit tests</p>
<hr></div>
<div class="section level2">
<h2 id="near-term-roadmap-what-done-looks-like">Near-term roadmap (what “done” looks like)<a class="anchor" aria-label="anchor" href="#near-term-roadmap-what-done-looks-like"></a></h2>
<ol style="list-style-type: decimal"><li>Robust build and check</li>
</ol><ul><li>Clean docs, imports, NAMESPACE.</li>
<li>Tests cover Stan parse/compile and standata shape edge cases.</li>
<li>Vignettes pass.</li>
</ul><ol start="2" style="list-style-type: decimal"><li>User experience parity with epidemia</li>
</ol><ul><li>Simple model specification.</li>
<li>Clear, slow, mathematical documentation.</li>
<li>“Do the right thing by default” priors and diagnostics.</li>
</ul><ol start="3" style="list-style-type: decimal"><li>Core extensions</li>
</ol><ul><li>Misclassification in Stan (not only simulator).</li>
<li>Optional ill-defined cause group.</li>
<li>Optional population uncertainty (latent multiplier on exposure).</li>
<li>Optional spatial structure (CAR/BYM2) if needed.</li>
</ul><hr></div>
<div class="section level2">
<h2 id="key-modelling-takeaways-why-this-package-exists">Key modelling takeaways (why this package exists)<a class="anchor" aria-label="anchor" href="#key-modelling-takeaways-why-this-package-exists"></a></h2>
<ul><li>The central challenge is not missing region-time cells, it is that the observation mechanism changes with conflict.</li>
<li>By modelling reporting explicitly, the package prevents common sign-flip artefacts in indirect mortality.</li>
<li>Simulation and strong tests are essential. If you cannot recover truth on simulated data with known reporting collapse, you cannot trust real-world inference.</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by OJ Watson, Greg Barnsley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

